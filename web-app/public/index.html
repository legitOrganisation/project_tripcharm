<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tripcharm Console</title>
  <link rel="icon" href="logo.svg" type="image/svg+xml">
  <link rel="stylesheet" href="styles.css"/>

  <!-- Google Maps JS API (Web Components) -->
  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhZjMrXAgxuA6U3rhsuHMl8rBe035WEf8&libraries=marker&v=beta">
  </script>
  <script type="module" src="https://unpkg.com/@googlemaps/extended-component-library@0.6"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <h1>Tripcharm</h1>
      <span class="muted" style="margin-left:8px;">Device Console</span>
    </div>
    <nav class="tabs">
      <a href="#/dashboard" id="tab-dashboard" class="tab active">Dashboard</a>
      <a href="#/geofencing" id="tab-geofencing" class="tab">Geofencing</a>
    </nav>
    <div class="right">
      <button id="export-btn" class="secondary small-hide">Export</button>
      <label class="import-label small-hide">
        Import <input id="import-file" type="file" accept="application/json" hidden>
      </label>
    </div>
  </header>

  <!-- Geofence Editor Panel (only visible in geofencing view) -->
  <section id="geofence-panel" class="view view-geofencing hidden">
    <div class="row">
      <strong>Geofencing</strong>
      <input id="gf-name" placeholder="Zone name"/>
      <button id="gf-circle" class="primary">Circle</button>
      <label>Radius (m)
        <input id="gf-radius" type="number" value="150" min="10" step="10" style="width:90px">
      </label>
      <button id="gf-polygon" class="primary-outline">Polygon</button>
      <button id="gf-save" class="success">Save</button>
      <button id="gf-clear" class="danger">Clear</button>
      <span id="gf-status" class="muted"></span>
    </div>

    <div class="row small">
      <label>Server
        <input id="server-base" placeholder="http://ma8w.ddns.net:3000" style="width:260px">
      </label>
      <label>Device ID
        <input id="device-id" value="default" style="width:160px">
      </label>
      <button id="test-vibrate" class="secondary">Test Vibrate</button>
      <span id="inside-flag" class="badge">inside?</span>
    </div>
  </section>

  <!-- DASHBOARD VIEW -->
  <main id="main" class="view view-dashboard">
    <div id="map-container">
      <gmp-map id="map"
               map-id="DEMO_MAP_ID"
               style="height:100%; width:100%; border-radius: 12px;"
               zoom="12"
               center="1.3521,103.8198">
        <gmp-advanced-marker id="device-marker"
                             position="1.3521,103.8198"
                             title="Device">
        </gmp-advanced-marker>
      </gmp-map>
    </div>

    <aside id="side">
      <div class="card">
        <h3>Live Device</h3>
        <div class="kv"><span>Latitude</span><span id="lat">–</span></div>
        <div class="kv"><span>Longitude</span><span id="lon">–</span></div>
        <div class="kv"><span>Updated</span><span id="updated">–</span></div>
        <div class="kv"><span>Battery</span><span id="battery">–</span></div>
        <div class="kv"><span>Status</span><span id="status">idle</span></div>
        <div class="row" style="margin-top:8px;">
          <label>Server
            <input id="server-base-dash" placeholder="http://ma8w.ddns.net:3000" style="width:240px">
          </label>
          <button id="refresh-now" class="secondary">Refresh</button>
        </div>
      </div>

      <div class="card">
        <h3>Saved Geofences</h3>
        <ul id="gf-list" class="list"></ul>
        <div style="margin-top:8px;">
          <a href="#/geofencing" class="primary-outline" style="padding:6px 10px; display:inline-block; border-radius:8px; border:1px solid var(--accent);">Open Geofencing</a>
        </div>
      </div>

      <div class="card">
        <h3>Events <span id="events-badge" class="pill">0</span></h3>
        <ul id="events-list" class="list list-compact"></ul>
        <div class="row" style="margin-top:8px;">
          <button id="ack-events" class="secondary">Acknowledge All</button>
          <button id="refresh-events" class="secondary">Refresh</button>
        </div>
      </div>
    </aside>
  </main>

  <!-- GEOFENCING VIEW -->
  <main id="main-geofencing" class="view view-geofencing hidden">
    <div id="map-container-geo">
      <gmp-map id="map-geo"
               map-id="DEMO_MAP_ID"
               style="height:100%; width:100%; border-radius: 12px;"
               zoom="12"
               center="1.3521,103.8198">
        <gmp-advanced-marker id="device-marker-geo"
                             position="1.3521,103.8198"
                             title="Device">
        </gmp-advanced-marker>
      </gmp-map>
    </div>

    <aside id="side-geo">
      <div class="card">
        <h3>Geofence Tools</h3>
        <p class="muted">Click the map to set a circle center or add polygon vertices, then Save.</p>
        <div class="kv"><span>Latitude</span><span id="lat-geo">–</span></div>
        <div class="kv"><span>Longitude</span><span id="lon-geo">–</span></div>
        <div class="kv"><span>Inside?</span><span id="inside-geo">–</span></div>
      </div>

      <div class="card">
        <h3>Saved Geofences</h3>
        <ul id="gf-list-geo" class="list"></ul>
      </div>
    </aside>
  </main>

  <footer class="footer">
    <span>Dashboard shows live location; Geofencing lets you draw zones. All zones persist in your browser (localStorage).</span>
  </footer>

  <!-- Toasts -->
  <div id="toasts"></div>

  <script type="module" src="index.js"></script>
</body>
</html>
